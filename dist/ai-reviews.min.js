(()=>{var v=class extends HTMLElement{#t;constructor(){super(),this.#t=this.#s.bind(this)}#s(c){let{id:u,open:d}=c.detail;u===this.getAttribute("id")&&(d?this.setAttribute("open",""):this.removeAttribute("open"))}connectedCallback(){this.getAttribute("id")!==null&&window.addEventListener("toggle-collapsible",this.#t)}disconnectedCallback(){window.removeEventListener("toggle-collapsible",this.#t)}toggle(){this.getAttribute("open")!==null?this.removeAttribute("open"):this.setAttribute("open","")}};customElements.define("custom-collapsible",v);var y=class extends HTMLElement{#t=2;#s=null;#e;static observedAttributes=["autoplay"];constructor(){super()}connectedCallback(){this.#e=this.querySelector(".slideshow-scrollable"),this.getAttribute("autoplay")!==null&&this.#a()}disconnectedCallback(){this.#r()}attributeChangedCallback(c,u,d){c==="autoplay"&&(d===null?this.#r():this.#a())}reset(){this.#t=2}get columns(){if(!this.#e)return console.error("CustomSlideShow -> columns getter -> this.#slideshow is undefinied"),1;let c=getComputedStyle(this.#e).getPropertyValue("--columns");return parseInt(c)}nextSlide(c){if(!this.#e)return console.error("CustomSlideShow -> nextSlide() -> this.#slideshow is undefinied"),{current:1,start:!1,end:!1};let u=this.#t+1,d=this.#e.children.length-(this.columns-1);if(u>d)return c&&(this.#t=2),{current:d-1,start:!1,end:null};let f=this.querySelector(`.slideshow-slide:nth-child(${u})`);return this.#e.scrollLeft=f.offsetLeft-this.#e.offsetLeft,this.#t=u,{current:u-1,start:!1,end:u===d}}previousSlide(){if(!this.#e)return console.error("CustomSlideShow -> previousSlide() -> this.#slideshow is undefinied"),{current:1,start:!1,end:!1};let c=this.#t-1;if(c<2)return{current:1,start:null,end:!1};let u=this.querySelector(`.slideshow-slide:nth-child(${c})`);return this.#e.scrollLeft=u.offsetLeft-this.#e.offsetLeft,this.#t=c,{current:c-1,start:c===2,end:!1}}#a(){clearInterval(this.#s),this.#s=setInterval(this.nextSlide.bind(this,!0),3e3)}#r(){clearInterval(this.#s)}};customElements.define("custom-slideshow",y);document.addEventListener("alpine:init",()=>{function p(a){return"message"in a}let c=firestore;class u{#t=null;#s;#e;#a={stars:0,single:!1};submitted=!1;constructor(){this.#s=3,this.reload()}reload(){this.#t=document.querySelector("#review-form")}#r(){if(!this.#t)return null;let e={year:"numeric",month:"long",day:"numeric"},r=new Intl.DateTimeFormat("es",e).format(new Date),{author:s,description:i}=Object.fromEntries(new FormData(this.#t));return{author:s,description:i,...this.#a,images:this.#e,date:r}}set stars(e){this.#a.stars=e}#o(e){return new Promise((t,r)=>{let s=new FileReader;s.onload=()=>{s.onload=null;let i=new Image;i.onload=()=>{i.onload=null;let o={src:i.src,width:i.width,height:i.height,aspectRatio:i.width/i.height,srcset:`${i.src} 300w, ${i.src} 500w, ${i.src} 750w, ${i.src} 900w`};t(o)},i.onerror=r,i.src=s.result},s.onerror=r,s.readAsDataURL(e)})}async uploadImages(e){let t=e.target.files;if(!t.length)return[];if(t.length>this.#s)return alert(`Solo pueden subirse ${this.#s} archivo(s)`),[];let r=[];for(let s=0;s<t.length;s++){if(t[s].size>4*1024*1024)return alert("Uno de los archivos es muy grande, m\xE1ximo 4MB"),[];if(!t[s].type.startsWith("image/"))return alert("Solo puedes cargar im\xE1genes"),[];r.push(this.#o(t[s]))}return this.#e=await Promise.all(r),this.#a.single=this.#e.length===1,[...this.#e]}deleteImage(e){if(this.#e.splice(e,1),this.#a.single=this.#e.length===1,!this.#e.length){let t=this.#t?.querySelector("input[type='file']");t&&(t.value="")}}submit(){let e=this.#r();return this.#a={stars:0,single:!1},this.#e=[],this.#t?.reset(),e&&(this.submitted=!0),e}}let d=new u;class f{#t;#s;#e;#a;#r;constructor(){this.#a=this.#o.bind(this),this.#r=this.#i.bind(this),this.reload()}reload(){this.#t=document.querySelector("#reviews-dialog");let[e,t]=document.querySelectorAll("variant-selects");this.#s=e,this.#e=t,this.#n()}show(){this.#t?.showModal()}hide(){this.#t?.close()}#o(e){let t=this.#s.querySelectorAll("input"),r=this.#e.querySelectorAll("input"),s=[...t].indexOf(e.target);r[s].checked=!0}#i(e){e.stopImmediatePropagation();let t=this.#s.querySelectorAll("input"),s=[...this.#e.querySelectorAll("input")].indexOf(e.target);t[s].click()}#n(){if(!this.#s||!this.#e){console.info("DialogController -> setupVariants() -> Any variant picker found");return}this.#s.removeEventListener("change",this.#a),this.#s.addEventListener("change",this.#a),this.#e.removeEventListener("change",this.#r),this.#e.addEventListener("change",this.#r)}}let g=new f;class w{#t;#s=!1;active;exists;country;#e={average:"0.0",individuals:[{v:0,p:0},{v:0,p:0},{v:0,p:0},{v:0,p:0},{v:0,p:0}]};#a=[{author:"Mar\xEDa Gonz\xE1lez",description:"Desde que compr\xE9 este producto, he ahorrado tanto tiempo como dinero. La entrega lleg\xF3 rapid\xEDsimo y en perfectas condiciones. Es incre\xEDble c\xF3mo facilita mi d\xEDa a d\xEDa. \xA1Definitivamente vale la pena probarlo, no me arrepiento de la compra!"},{author:"Carlos Ram\xEDrez",description:"Llevaba meses buscando algo as\xED y finalmente lo encontr\xE9 aqu\xED. La atenci\xF3n al cliente fue muy buena, despejaron todas mis dudas con rapidez y profesionalismo. Muy satisfecho con la compra, es justo lo que necesitaba para resolver mi problema"},{author:"Laura Fern\xE1ndez",description:"No esperaba que este producto fuera de tanta calidad, pero ahora estoy muy satisfecha. La entrega fue r\xE1pida y sin complicaciones, lo que me dio mucha tranquilidad. Recomiendo este producto sin dudarlo, realmente super\xF3 mis expectativas iniciales."},{author:"Juan Mart\xEDnez",description:"Nunca me fiaba de comprar en estas p\xE1ginas, pero este producto me hizo cambiar de opini\xF3n. El servicio al cliente fue muy amable y eficiente. Estoy muy contento con la compra y siento que puedo confiar en este sitio para futuras compras."},{author:"Ana L\xF3pez",description:"Pens\xE9 que ser\xEDa una estafa, pero el producto lleg\xF3 en muy poco tiempo y fue tal como lo describen. Funcion\xF3 perfectamente desde el primer d\xEDa. Honestamente, estoy muy impresionado y definitivamente lo recomendar\xEDa a cualquiera."},{author:"Luis P\xE9rez",description:"Este producto ha solucionado un problema que ten\xEDa desde hace tiempo. La entrega fue incre\xEDblemente r\xE1pida y eficiente. Realmente cambi\xF3 mi rutina diaria para mejor. Muy satisfecho con la compra y siempre lo recomiendo a amigos y conocidos."},{author:"Marta S\xE1nchez",description:"Estaba buscando una soluci\xF3n a mi problema y este producto fue perfecto. El servicio al cliente fue muy servicial y atento, me ayudaron en todo momento. Lo recomiendo sin dudar, es una inversi\xF3n que realmente vale la pena."},{author:"Diego Rivera",description:"El precio me pareci\xF3 muy razonable para la calidad que ofrece. Realmente ha sido una muy buena inversi\xF3n. He notado mejoras significativas en mi rutina diaria desde que lo uso. Es definitivamente algo que recomendar\xEDa a quien busque calidad a buen precio."},{author:"Patricia G\xF3mez",description:"Es justo lo que necesitaba. La atenci\xF3n al cliente fue excelente y siempre estuvieron dispuestos a ayudar con mis dudas. Estoy muy satisfecho con mi compra y no dudar\xE9 en recomendar este producto a mis amigos y familiares."},{author:"Javier Torres",description:"Ten\xEDa mis dudas pero este producto cumpli\xF3 con todas mis expectativas. La entrega fue muy r\xE1pida, lleg\xF3 antes de lo que esperaba y sin ning\xFAn inconveniente. Estoy muy contento con la compra y lo recomendar\xEDa sin dudar."},{author:"Claudia Hern\xE1ndez",description:"Este producto ha sido de gran ayuda para mi d\xEDa a d\xEDa. La atenci\xF3n al cliente es fenomenal y resolvieron todas mis dudas inmediatamente. Lo recomiendo a quienes busquen una buena soluci\xF3n para facilitar su rutina diaria."},{author:"Alberto Ruiz",description:"No era f\xE1cil encontrar algo as\xED, pero aqu\xED lo tienen. La entrega fue sorprendentemente r\xE1pida y eficiente, lo cual agradezco mucho. Muy feliz con mi compra, el producto funciona perfectamente y cumple con todas mis expectativas."},{author:"Daniela Castillo",description:"La durabilidad de este producto es impresionante. Lo uso todos los d\xEDas y sigue como nuevo. Realmente lo recomendar\xEDa a cualquiera que busque un producto fiable y duradero. Estoy extremadamente satisfecho con mi compra."},{author:"Pablo Vargas",description:"Me sorprendi\xF3 lo r\xE1pido que lleg\xF3 el paquete y la calidad del producto. El env\xEDo fue tan r\xE1pido que no tuve que esperar nada. Estoy muy satisfecho con la compra y el producto cumple todas mis expectativas."},{author:"Sof\xEDa Morales",description:"Este producto ha sido clave para mejorar mi rutina diaria. Me ahorra mucho tiempo y esfuerzo, y la verdad es que fue una inversi\xF3n excelente. Sin duda, fue una buena compra que volver\xEDa a hacer sin pensarlo dos veces."},{author:"Fernando Guti\xE9rrez",description:"La rapidez en la entrega me sorprendi\xF3 gratamente. El producto es de buena calidad y cumple su funci\xF3n perfectamente, justo lo que necesitaba. Definitivamente lo recomendar\xEDa a quienes buscan eficiencia y calidad en un mismo producto."},{author:"Carolina Castro",description:"El producto es justo lo que necesitaba y la atenci\xF3n al cliente fue estupenda. Me ayudaron con todas mis dudas de forma r\xE1pida y efectiva. Lo recomendar\xE9 a mis amigos, estoy completamente satisfecho con mi experiencia de compra."},{author:"Ricardo D\xEDaz",description:"Hab\xEDa probado otros y ninguno como este. La calidad del producto es excelente y cumpli\xF3 con todas mis expectativas. La entrega fue muy r\xE1pida y sin problemas. \xA1Lo recomiendo a cualquiera que busque calidad y eficiencia en un solo producto!"},{author:"Elena Vargas",description:"Desde que lo tengo, he notado una mejora significativa en mis actividades diarias. La atenci\xF3n al cliente fue muy cordial y siempre estuvieron disponibles para ayudarme. Definitivamente lo recomendar\xE9, realmente ha marcado una diferencia en mi rutina."},{author:"Andr\xE9s Mendoza",description:"Este producto me ha facilitado mucho la vida. Lleg\xF3 antes de lo previsto y en perfectas condiciones. Estoy muy satisfecho con la compra y lo recomendar\xE9 sin dudas a quienes buscan soluciones pr\xE1cticas y de calidad."}];#r=[];#o;#i=[];constructor(e){this.#t=e;let t=JSON.parse(document.querySelector("#reviews-media").textContent);if(!t)return;for(let o=0;o<t.length;o++){let l=t[o];l.srcset=`${l.src}&width=300 300w, ${l.src}&width=500 500w, ${l.src}&width=750 750w, ${l.src}&width=900 900w`,l.src=`${l.src}&width=900`,delete l.preview_image}let s=document.querySelector("#images-pattern").value.replace(/ /g,"").split(",").map(Number),i=[...s];for(let o=0;o<s.length;o++){let l=i[o];if(l>9){let h=l.toString().split("").map(Number);i.splice(o,1);for(let m=0;m<h.length;m++)i.splice(o+m,0,h[m])}}this.#o=i,this.#r=t}async init(){await this.#n()}add(e){this.#i.unshift(e),this.#e.individuals[e.stars-1]=this.#e.individuals[e.stars-1]+1;let r=this.#i.reduce((s,i)=>s+i.stars,0)/reviews.length;this.#e.average=r.toFixed(1)}remove(e){this.#i.splice(e,1),this.#e.individuals[review.stars-1]=this.#e.individuals[review.stars-1]-1;let r=this.#i.reduce((s,i)=>s+i.stars,0)/reviews.length;this.#e.average=r.toFixed(1)}group(){if(!this.#r.length)return;let e=this.#i,t=[],r=this.#o[this.#o.length-1],s=0;for(let i=0;i<this.#o.length-1;i++){let o=this.#r.slice(s,s+this.#o[i]);t.push(o),s+=this.#o[i]}for(let i=s;i<this.#r.length;i+=r){let o=this.#r.slice(i,i+r);t.push(o)}for(let i=0;i<t.length;i++)e[i].images=t[i],t[i].length===1&&(e[i].single=!0)}rate(){let e=this.#i,t=.05,r=0,s=[0,0,0,0,0];for(let o=0;o<e.length;o++){let l=Math.random()<t?4:5;e[o].stars=l,s[l-1]=s[l-1]+1,r=r+l}for(let o=0;o<5;o++){let l=s[o],h=Math.round(l/e.length*100);this.#e.individuals[o]={v:l,p:h}}let i=r/e.length;this.#e.average=i.toFixed(1)}date(){let e=this.#i,t=new Date,r=864e5,s={year:"numeric",month:"long",day:"numeric"},i=new Intl.DateTimeFormat("es",s);for(let o=0;o<e.length;o++){let l=Math.floor(Math.random()*11)*r,h=new Date(t.getTime()-l);e[o].date=i.format(h)}}get rating(){return structuredClone(this.#e)}get reviews(){return structuredClone(this.#i)}get raw(){let e=structuredClone(this.#i),t=[];for(let r=0;r<e.length;r++){let{author:s,description:i}=e[r];t.push({author:s,description:i})}return t}set reviews(e){let t=[],r=e.length-this.#i.length;for(let s=0;s<Math.min(e.length,this.#i.length);s++){let i=this.#i[s].author;t.push({author:i,description:e[s]})}if(r>0)for(let s=e.length-r;s<e.length;s++)t.push({description:e[s]});this.#i=t,this.group(),this.rate(),this.date()}set names(e){for(let t=0;t<Math.min(e.length,this.#i.length);t++)this.#i[t].author=e[t]}async#n(){if(!this.#s){let e=document.querySelector("#store-id").value,t=document.querySelector("#product-id").value,r=await this.#t.reviews(e,t);if(p(r))throw r;let s=r.reviews;r.exists||(s=this.#a),this.active=r.active,this.exists=r.exists,this.country=r.country,this.#i=s,this.group(),this.rate(),this.date(),this.#s=!0}}}let n=new w(c);function b(){d.reload(),g.reload()}Shopify.designMode&&document.addEventListener("shopify:section:load",b),Alpine.data("scroll",()=>({reviews:{current:1,start:!0,end:!1},dialog:{current:1,start:!0,end:!1},nextReviewSlide(){this.reviews=this.$el?.closest("custom-slideshow")?.nextSlide()},previousReviewSlide(){this.reviews=this.$el?.closest("custom-slideshow")?.previousSlide()},resetDialog(){this.dialog={current:1,start:!0,end:!1},this.$el?.reset()},nextDialogSlide(){this.dialog=this.$el?.closest("custom-slideshow")?.nextSlide()},previousDialogSlide(){this.dialog=this.$el?.closest("custom-slideshow")?.previousSlide()}})),Alpine.data("form",()=>({images:[],single:!0,submitted:!1,lastStar:null,async uploadImages(a){try{let e=await d.uploadImages(a);this.single=e.length===1,this.images=e}catch(e){alert(e)}},deleteImage(a){this.images.splice(a,1),this.single=this.images.length===1,d.deleteImage(a)},rate(a){d.stars=a+1,this.lastStar?.classList?.remove("active"),this.$el?.classList?.add("active"),this.lastStar=this.$el},submit(){let a=d.submit();if(this.lastStar?.classList?.remove("active"),this.single=!1,this.images=[],!a){console.error("FormController -> submit() -> this.#form is undefined"),alert("Ocurri\xF3 un error al momento de subir la rese\xF1a. Por favor, recargue la p\xE1gina.");return}this.$dispatch("form-submitted",a),this.submitted=!0}})),Alpine.data("aiReviews",()=>({async init(){this.$watch("success",a=>{a&&this.$dispatch("toggle-collapsible",{id:"1",open:!0})}),this.$watch("error",a=>{a&&this.$dispatch("toggle-collapsible",{id:"1",open:!0})});try{await n.init(),this.country=n.country,this.reviews=n.reviews,this.rating=n.rating}catch(a){console.error(a),this.error=a}finally{this.loading=!1,this.initialized=!1}},reviews:[],rating:n.rating,expandedReview:null,country:n.country,initialized:!0,loading:!0,success:null,info:null,error:null,expand(a){a?(this.expandedReview=a,g.show()):(this.$dispatch("dialog-close"),g.hide(),this.expandedReview=null)},reset(){this.loading=!0,this.$dispatch("toggle-collapsible",{id:"1",open:!1}),setTimeout(()=>{this.success=null,this.info=null,this.error=null},300)},async saveReviews(){if(!this.loading){if(!this.$el){console.error("SaveReviews -> this.$el (form) is not defined");return}this.reset();try{let a=Object.fromEntries(new FormData(this.$el)),e={storeId:a.storeId,product:{id:a.productId,name:a.productName,reviews:n.raw}},r=await(await fetch("https://api.velkamhell-aireviews.com/reviews",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})).json();if(!r.ok)throw r;this.success={message:"Rese\xF1as guardadas exitosamente."}}catch(a){console.error(a),this.error=a}finally{this.loading=!1}}},async generateReviews(){if(!this.loading){if(!this.$el){console.error("GenerateReviews -> this.$el (form) is not defined");return}try{let a=Object.fromEntries(new FormData(this.$el));if(!a.description)throw new Error("Debes incluir una descripci\xF3n del producto");this.reset();let t=await(await fetch("https://api.velkamhell-aireviews.com/reviews/generate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...a,country:n.country})})).json();if(!t.ok)throw t;n.reviews=t.reviews,this.reviews=n.reviews,this.rating=n.rating,this.success={message:`\xA1${t.reviews.length} rese\xF1as generadas exitosamente!. Si faltan nombres presionar el boton 'Nombres'`}}catch(a){console.error(a),this.error=a}finally{this.loading=!1}}},async generateNames(){if(!this.loading){if(!this.$el){console.error("GenerateNames -> this.$el (form) is not defined");return}this.reset();try{let a=Object.fromEntries(new FormData(this.$el)),t=await(await fetch("https://api.velkamhell-aireviews.com/utils/names",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...a,country:n.country})})).json();if(!t.ok)throw t;n.names=t.names,this.reviews=n.reviews,this.success={message:"\xA1Nombres generadas exitosamente!"}}catch(a){console.error(a),this.error=a}finally{this.loading=!1}}},generateStars(){n.rate(),this.reviews=n.reviews,this.rating=n.rating},addReview(a){n.add(a),this.reviews.unshift(a),this.reviews.rating=n.rating},removeReview(a){n.remove(a),this.reviews.splice(a,1),this.reviews.rating=n.rating}}))});})();
